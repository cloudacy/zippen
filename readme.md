# snap zip

`snap-zip` is a small and easy to use zip generator. It can be used to pack multiple files / buffers into one .zip file / buffer.

This package was built based on the [**pkware .ZIP File Format Specification**](https://pkware.cachefly.net/webdocs/casestudies/APPNOTE.TXT).

## usage

### import

#### commonjs
```javascript
const Zip = require('snap-zip').Zip
```

#### es6 module
```javascript
import {Zip} from 'snap-zip'
```

### create zip object
```javascript
const zip = new Zip()
```

### add entries to the zip

##### arguments
- path - `string`: The location of the file to be stored in the .zip file (may also contain directories: e.g. `foo/bar.txt`)
- last modified date - `Date`: A date object, holding the last modified date of the file or directory
- data - `Buffer | undefined`: If the entry is a file, this should be a buffer, holding the uncompressed data. If it is a directory, pass `undefined` here.

```javascript
zip.addEntry('foo.txt', new Date(), Buffer.from('bar'))
```

### return the resulting .zip file buffer

This will return the resulting .zip buffer.

```javascript
zip.build()
```

### store resulting .zip file

`write` will store the resulting .zip file at the given file path.

##### arguments
- path - `string | number | Buffer | URL`: The location of the resulting .zip file.

```javascript
zip.write('foo.zip')
```

## example
```javascript
const zip = new Zip()
zip.addEntry('foo.txt', new Date(), Buffer.from('bar'))
zip.write('foo.zip')
```

## general zip structure

- `local file header 1`
- `encryption header 1`
- `file data 1`
- `data descriptor 1`
- ...
- `local file header n`
- `encryption header n`
- `file data n`
- `data descriptor n`
- `archive decryption header`
- `archive extra data record`
- `central directory header 1`
- ...
- `central directory header n`
- `zip64 end of central directory record`
- `zip64 end of central directory locator`
- `end of central directory record`

### example of a .zip file

The following example is a hexdump of a .zip file, holding one file, called `abc.txt` with the content `abc\n`. The file was generated by a macOS 10.14.2 system.

All parts of the .zip file were grouped to the pieces of a .zip file. The bytes were also grouped by their meaning, based on the specification.

#### local file header block

| local file header signature | version needed to extract | general purpose bit flag | compression algorithm | last mod file time (MSDOS format) | last mod file date (MSDOS format) | crc-32 | compressed size | uncompressed size | file name length | extra field length | file name | extra field |
|---|---|---|---|---|---|---|---|---|---|---|---|---|
| `50 4b 03 04` | `14 00` | `08 00` | `08 00` | `6b 81` | `8f 4d` | `00 00 00 00` | `00 00 00 00` | `00 00 00 00` | `07 00` | `10 00` | `61 62 63 2e 74 78 74` | `55 58 0c 00 a1 19 15 5c 9a 19 15 5c f5 01 14 00` |

#### compressed data block(s)

| compressed data |
|---|
| `4b 4c 4a e6 02 00` |

#### data descriptor block(s)

| data descriptor signature (unofficial) | crc-32 | compressed size | uncompressed size |
|---|---|---|---|
| `50 4b 07 08` | `4e 81 88 47` | `06 00 00 00` | `04 00 00 00` |

#### central directory block(s)

| central file header signature | version made by | version needed to extract | general purpose bit flag | compression method | last mod file time (MSDOS format) | last mod file date (MSDOS format) | crc-32 | compressed size | uncompressed size | file name length | extra field length | file comment length | disk number start | internal file attributes | external file attributes | relative offset of local header | file name | extra field |
|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|
| `50 4b 01 02` | `15 03` | `14 00` | `08 00` | `08 00` | `6b 81` | `8f 4d` | `4e 81 88 47` | `06 00 00 00` | `04 00 00 00` | `07 00` | `0c 00` | `00 00` | `00 00` | `00 00` | `00 40 a4 81` | `00 00 00 00` | `61 62 63 2e 74 78 74` | `55 58 08 00 a1 19 15 5c 9a 19 15 5c` |

#### end of central directories block

| end of central directories signature | disk number | disk number | number of entries | number of entries on this disk | size of central directory block(s) | offset of central directory block(s) | comment length |
|---|---|---|---|---|---|---|---|
| `50 4b 05 06` | `00 00` | `00 00` | `01 00` | `01 00` | `41 00 00 00` | `4b 00 00 00` | `00 00` |


